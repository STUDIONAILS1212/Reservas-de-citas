<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>STUDIO NAILS BY LAURA SANCHEZ - Reserva de Citas</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap');
  :root {
    --pink-light: #ffcee7;
    --pink-medium: #ff69b4;
    --pink-dark: #c71585;
    --white: #ffffff;
    --gray-light: #f7f7f7;
    --gray-dark: #444;
  }
  * {
    box-sizing: border-box;
  }
  body {
    font-family: 'Poppins', sans-serif;
    background: var(--pink-light);
    margin: 0; padding: 0;
    display: flex;
    flex-direction: column;
    min-height: 100vh;
    color: var(--pink-dark);
  }
  header {
    background: var(--pink-medium);
    color: var(--white);
    padding: 1.5rem;
    text-align: center;
    font-size: 1.8rem;
    font-weight: 600;
    box-shadow: 0 2px 6px var(--pink-dark);
  }
  main {
    flex: 1;
    padding: 1rem 1.5rem 3rem;
    max-width: 900px;
    margin: 0 auto;
  }
  h2 {
    margin-top: 0;
    color: var(--pink-dark);
  }
  .tabs {
    display: flex;
    margin-bottom: 1rem;
  }
  .tab {
    flex: 1;
    text-align: center;
    background: var(--pink-medium);
    color: var(--white);
    padding: 0.75rem;
    cursor: pointer;
    font-weight: 600;
    border-radius: 6px 6px 0 0;
    user-select: none;
    border-bottom: 3px solid transparent;
    transition: background-color 0.3s, border-bottom-color 0.3s;
  }
  .tab.active {
    background: var(--pink-dark);
    border-bottom-color: var(--white);
  }
  .tab:not(.active):hover {
    background: #ff85c1;
  }
  .content {
    background: var(--white);
    padding: 1.5rem;
    border-radius: 0 6px 6px 6px;
    box-shadow: 0 4px 8px rgba(199,21,133,0.15);
    min-height: 350px;
  }
  /* Reservation form styles */
  form {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }
  label {
    font-weight: 600;
  }
  input[type="text"],
  input[type="email"],
  input[type="date"],
  select,
  input[type="time"] {
    padding: 0.5rem;
    border: 1.8px solid var(--pink-medium);
    border-radius: 6px;
    outline-offset: 2px;
    outline-color: var(--pink-light);
    font-size: 1rem;
    transition: border-color 0.3s;
  }
  input[type="text"]:focus,
  input[type="email"]:focus,
  input[type="date"]:focus,
  select:focus,
  input[type="time"]:focus {
    border-color: var(--pink-dark);
  }
  button {
    background: var(--pink-dark);
    color: var(--white);
    border: none;
    padding: 0.7rem 1.5rem;
    font-weight: 700;
    border-radius: 6px;
    cursor: pointer;
    font-size: 1.1rem;
    transition: background-color 0.3s;
    align-self: start;
  }
  button:hover {
    background: #a10d5a;
  }
  /* Reservation list for admins */
  .reservation-list {
    max-height: 300px;
    overflow-y: auto;
  }
  .reservation {
    border: 2px solid var(--pink-medium);
    border-radius: 6px;
    padding: 0.75rem 1rem;
    margin-bottom: 0.8rem;
    display: flex;
    flex-direction: column;
    gap: 0.3rem;
  }
  .reservation-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-weight: 600;
  }
  .reservation-status {
    padding: 0.2rem 0.5rem;
    border-radius: 4px;
    font-size: 0.85rem;
    font-weight: 700;
    width: max-content;
  }
  .status-pending {
    background: #ffe6f1;
    color: var(--pink-dark);
  }
  .status-accepted {
    background: #d7f6e7;
    color: #2a7a3a;
  }
  .status-rejected {
    background: #fddede;
    color: #a71d2a;
  }
  .btn-action {
    padding: 0.3rem 0.7rem;
    border: none;
    border-radius: 6px;
    font-weight: 600;
    cursor: pointer;
    color: var(--white);
    margin-left: 0.3rem;
    font-size: 0.85rem;
    transition: background-color 0.3s;
    user-select: none;
  }
  .btn-accept {
    background: #2a7a3a;
  }
  .btn-accept:hover {
    background: #1e5323;
  }
  .btn-reject {
    background: #a71d2a;
  }
  .btn-reject:hover {
    background: #6e111d;
  }
  /* Admin availability section */
  .availability-controls {
    margin-top: 1rem;
    background: #fff0fb;
    padding: 1rem;
    border-radius: 6px;
  }
  .days-toggle {
    display: flex;
    justify-content: space-between;
    flex-wrap: wrap;
    gap: 0.6rem;
  }
  .day-toggle {
    flex: 1 1 30%;
    background: var(--pink-light);
    border: 2px solid var(--pink-medium);
    border-radius: 6px;
    padding: 0.5rem;
    text-align: center;
    font-weight: 600;
    cursor: pointer;
    user-select: none;
    transition: background-color 0.3s, border-color 0.3s;
  }
  .day-toggle.available {
    background: var(--pink-medium);
    color: var(--white);
    border-color: var(--pink-dark);
  }
  .day-toggle:hover {
    background: var(--pink-dark);
    color: var(--white);
    border-color: var(--pink-dark);
  }
  /* Admin login modal */
  #admin-login-modal {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.5);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 9999;
  }
  #admin-login-modal.hidden {
    display: none;
  }
  #admin-login-box {
    background: var(--white);
    padding: 2rem;
    border-radius: 12px;
    width: 320px;
    box-shadow: 0 4px 12px rgba(199,21,133,0.3);
  }
  #admin-login-box h3 {
    margin-top: 0;
    margin-bottom: 1.2rem;
    color: var(--pink-dark);
    text-align: center;
  }
  #admin-login-box label {
    font-weight: 600;
  }
  #admin-login-box input[type="password"] {
    width: 100%;
    padding: 0.5rem;
    margin: 0.5rem 0 1rem;
    border: 1.8px solid var(--pink-medium);
    border-radius: 6px;
    font-size: 1rem;
  }
  #admin-login-box button {
    width: 100%;
  }
  /* Notification styling */
  #notification {
    position: fixed;
    bottom: 1.5rem;
    right: 1.5rem;
    background: var(--pink-dark);
    color: var(--white);
    padding: 0.7rem 1rem;
    border-radius: 8px;
    font-weight: 600;
    opacity: 0.9;
    box-shadow: 0 4px 9px rgba(199,21,133,0.6);
    z-index: 10000;
  }
  /* Responsive */
  @media (max-width: 600px) {
    .days-toggle {
      flex-direction: column;
    }
    .day-toggle {
      flex: 1 1 100%;
    }
  }
</style>
</head>
<body>
<header>STUDIO NAILS BY LAURA SANCHEZ - Reserva de Citas</header>
<main>
  <div class="tabs">
    <div class="tab active" id="tab-client">Reservar Cita</div>
    <div class="tab" id="tab-admin">Administración</div>
  </div>
  <section id="client-section" class="content">
    <h2>Reserva tu cita</h2>
    <form id="reservation-form" novalidate>
      <label for="client-name">Nombre completo:</label>
      <input type="text" id="client-name" name="client-name" placeholder="Tu nombre completo" required minlength="3" />

      <label for="client-email">Correo electrónico:</label>
      <input type="email" id="client-email" name="client-email" placeholder="ejemplo@correo.com" required />

      <label for="reservation-date">Fecha de la cita:</label>
      <input type="date" id="reservation-date" name="reservation-date" required />

      <label for="reservation-time">Hora de la cita:</label>
      <select id="reservation-time" name="reservation-time" required>
        <option value="">Selecciona una hora</option>
      </select>

      <button type="submit">Reservar</button>
    </form>
  </section>

  <section id="admin-section" class="content" style="display:none;">
    <h2>Panel de Administración</h2>
    <div id="admin-controls" style="display:none;">
      <h3>Reservas pendientes</h3>
      <div class="reservation-list" id="reservation-list"></div>
      <div class="availability-controls">
        <h3>Días disponibles</h3>
        <div class="days-toggle" id="days-toggle">
          <!-- Days toggles will be inserted here -->
        </div>
      </div>
      <button id="admin-logout-btn" style="margin-top: 1rem; background: var(--pink-medium);">Cerrar sesión</button>
    </div>
    <div id="login-prompt" style="text-align:center; color: var(--pink-dark); font-weight: 600;">
      <p>Por favor, inicia sesión como administrador para ver las reservas.</p>
      <button id="open-login-btn" style="margin-top: 0.5rem; background: var(--pink-dark); color: var(--white); padding: 0.6rem 1.2rem; border-radius: 6px; border:none; cursor:pointer;">Iniciar sesión</button>
    </div>
  </section>
</main>

<!-- Admin login modal -->
<div id="admin-login-modal" class="hidden" role="dialog" aria-modal="true" aria-labelledby="login-title">
  <div id="admin-login-box">
    <h3 id="login-title">Acceso Administrador</h3>
    <label for="admin-password">Contraseña:</label>
    <input type="password" id="admin-password" autocomplete="current-password" />
    <button id="btn-login">Entrar</button>
  </div>
</div>

<!-- Notification -->
<div id="notification" style="display:none;"></div>

<script>
  (() => {
    'use strict';

    // --- Constants, data and helpers ---

    const admins = [
      { username: "admin1", password: "1234" },
      { username: "admin2", password: "5678" }
    ];
    // For simple demo, username is not asked, only password checked for two admins password matches
    // Passwords: admin1 = "1234", admin2 = "5678"

    const daysOfWeek = ['Domingo', 'Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado'];

    // Default availability: Monday to Friday, 07:00 - 21:00 every hour
    let availability = {
      1: true, // Monday
      2: true,
      3: true,
      4: true,
      5: true,
      0: false, // Sunday
      6: false  // Saturday
    };

    const dailyHours = [
      "07:00","08:00","09:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00","21:00"
    ];

    // Storage keys
    const STORAGE_KEYS = {
      reservations: 'studioNails_reservations',
      availability: 'studioNails_availability',
      adminLoggedIn: 'studioNails_admin_loggedIn'
    };

    // HTML elements
    const tabClient = document.getElementById('tab-client');
    const tabAdmin = document.getElementById('tab-admin');
    const clientSection = document.getElementById('client-section');
    const adminSection = document.getElementById('admin-section');
    const reservationForm = document.getElementById('reservation-form');
    const reservationDateInput = document.getElementById('reservation-date');
    const reservationTimeSelect = document.getElementById('reservation-time');
    const reservationList = document.getElementById('reservation-list');

    const adminControls = document.getElementById('admin-controls');
    const loginPrompt = document.getElementById('login-prompt');
    const adminLoginModal = document.getElementById('admin-login-modal');
    const adminPasswordInput = document.getElementById('admin-password');
    const adminLoginBtn = document.getElementById('btn-login');
    const openLoginBtn = document.getElementById('open-login-btn');
    const adminLogoutBtn = document.getElementById('admin-logout-btn');
    const daysToggle = document.getElementById('days-toggle');

    const notificationEl = document.getElementById('notification');

    let reservations = [];
    let adminLoggedIn = false;

    // --- Utility functions ---
    function showNotification(message, duration = 3000) {
      notificationEl.textContent = message;
      notificationEl.style.display = 'block';
      setTimeout(() => {
        notificationEl.style.display = 'none';
      }, duration);
    }
    function saveReservations() {
      localStorage.setItem(STORAGE_KEYS.reservations, JSON.stringify(reservations));
    }
    function loadReservations() {
      const data = localStorage.getItem(STORAGE_KEYS.reservations);
      reservations = data ? JSON.parse(data) : [];
    }
    function saveAvailability() {
      localStorage.setItem(STORAGE_KEYS.availability, JSON.stringify(availability));
    }
    function loadAvailability() {
      const data = localStorage.getItem(STORAGE_KEYS.availability);
      if(data) {
        availability = JSON.parse(data);
      }
    }
    function saveAdminLogin(isLoggedIn) {
      localStorage.setItem(STORAGE_KEYS.adminLoggedIn, isLoggedIn ? 'yes' : 'no');
    }
    function loadAdminLogin() {
      const loggedIn = localStorage.getItem(STORAGE_KEYS.adminLoggedIn);
      adminLoggedIn = (loggedIn === 'yes');
    }
    function formatDate(dateStr) {
      const d = new Date(dateStr);
      if(isNaN(d)) return '';
      return d.toLocaleDateString('es-ES', { year:'numeric', month:'long', day:'numeric' });
    }
    function generateId() {
      return 'rsv-' + Date.now() + '-' + Math.random().toString(36).substr(2,5);
    }

    // --- Tab Switching ---
    function switchTab(tab) {
      if(tab === 'client') {
        tabClient.classList.add('active');
        tabAdmin.classList.remove('active');
        clientSection.style.display = '';
        adminSection.style.display = 'none';
      } else {
        tabAdmin.classList.add('active');
        tabClient.classList.remove('active');
        adminSection.style.display = '';
        clientSection.style.display = 'none';
        if(adminLoggedIn) {
          showAdminControls();
        } else {
          showLoginPrompt();
        }
      }
    }

    tabClient.addEventListener('click', () => switchTab('client'));
    tabAdmin.addEventListener('click', () => switchTab('admin'));

    // --- Admin Login ---
    function openLoginModal() {
      adminLoginModal.classList.remove('hidden');
      adminPasswordInput.value = '';
      adminPasswordInput.focus();
    }
    function closeLoginModal() {
      adminLoginModal.classList.add('hidden');
    }
    openLoginBtn.addEventListener('click', openLoginModal);
    adminLoginBtn.addEventListener('click', () => {
      const pw = adminPasswordInput.value.trim();
      if(!pw) {
        alert('Por favor, ingresa la contraseña');
        return;
      }
      // Validate password against admins
      const matchedAdmin = admins.find(adm => adm.password === pw);
      if(matchedAdmin) {
        adminLoggedIn = true;
        saveAdminLogin(true);
        closeLoginModal();
        showAdminControls();
        showNotification('Sesión iniciada como administrador', 2000);
      } else {
        alert('Contraseña incorrecta');
      }
    });
    adminPasswordInput.addEventListener('keyup', e => {
      if(e.key === 'Enter') adminLoginBtn.click();
    });
    adminLogoutBtn.addEventListener('click', () => {
      adminLoggedIn = false;
      saveAdminLogin(false);
      showLoginPrompt();
      showNotification('Sesión cerrada', 2000);
    });

    function showAdminControls() {
      adminControls.style.display = '';
      loginPrompt.style.display = 'none';
      renderReservationList();
      renderDaysToggle();
    }
    function showLoginPrompt() {
      adminControls.style.display = 'none';
      loginPrompt.style.display = '';
    }

    // --- Reservation Form ---

    // Update reservation date min to today
    function setMinDate() {
      const today = new Date();
      const isoToday = today.toISOString().split('T')[0];
      reservationDateInput.min = isoToday;
    }

    // Populate time select with available time slots on chosen date if day is available
    function updateTimeOptions() {
      const selectedDate = reservationDateInput.value;
      if(!selectedDate) {
        reservationTimeSelect.innerHTML = '<option value="">Selecciona una hora</option>';
        reservationTimeSelect.disabled = true;
        return;
      }
      const dateObj = new Date(selectedDate + 'T00:00');
      const dayNum = dateObj.getDay();

      if(!availability[dayNum]) {
        reservationTimeSelect.innerHTML = '<option value="">Día no disponible</option>';
        reservationTimeSelect.disabled = true;
        return;
      }

      // Find hours already booked on this date and mark them unavailable
      const bookedTimes = reservations
        .filter(r => r.fecha === selectedDate && r.estado === 'aceptada')
        .map(r => r.hora);

      let optionsHtml = '<option value="">Selecciona una hora</option>';
      dailyHours.forEach(h => {
        if(bookedTimes.includes(h)) {
          optionsHtml += `<option value="${h}" disabled>${h} (Reservado)</option>`;
        } else {
          optionsHtml += `<option value="${h}">${h}</option>`;
        }
      });
      reservationTimeSelect.innerHTML = optionsHtml;
      reservationTimeSelect.disabled = false;
    }

    reservationDateInput.addEventListener('change', updateTimeOptions);

    reservationForm.addEventListener('submit', (e) => {
      e.preventDefault();

      if(!reservationForm.checkValidity()) {
        reservationForm.reportValidity();
        return;
      }
      const name = reservationForm['client-name'].value.trim();
      const email = reservationForm['client-email'].value.trim();
      const fecha = reservationForm['reservation-date'].value;
      const hora = reservationForm['reservation-time'].value;

      if(!availability[new Date(fecha).getDay()]) {
        alert('El día seleccionado no está disponible para reservas.');
        return;
      }
      // Check if time slot already booked and accepted
      if(reservations.some(r => r.fecha === fecha && r.hora === hora && r.estado === 'aceptada')) {
        alert('La hora seleccionada ya está reservada. Por favor elige otra.');
        updateTimeOptions();
        reservationTimeSelect.value = '';
        return;
      }

      const newReservation = {
        id: generateId(),
        nombre_cliente: name,
        email_cliente: email,
        fecha,
        hora,
        estado: 'pendiente',
        creado_en: new Date().toISOString()
      };
      reservations.push(newReservation);
      saveReservations();
      reservationForm.reset();
      setMinDate();
      updateTimeOptions();
      showNotification('Reserva enviada. Espera la confirmación del administrador.', 4000);
    });


    // --- Admin Reservation List ---
    function renderReservationList() {
      if(!adminLoggedIn) return;
      if(reservations.length === 0) {
        reservationList.innerHTML = '<p>No hay reservas registradas.</p>';
        return;
      }

      // Show pending reservations first, then accepted, then rejected
      const sortedReservations = [...reservations].sort((a,b) => {
        const statusOrder = {pendiente:1, aceptada:2, rechazada:3};
        return statusOrder[a.estado] - statusOrder[b.estado] || new Date(a.creado_en) - new Date(b.creado_en);
      });

      reservationList.innerHTML = '';
      sortedReservations.forEach(r => {
        const rDiv = document.createElement('div');
        rDiv.classList.add('reservation');

        const header = document.createElement('div');
        header.className = 'reservation-header';

        const nameTitle = document.createElement('div');
        nameTitle.textContent = r.nombre_cliente + ' - ' + formatDate(r.fecha) + ' ' + r.hora;
        header.appendChild(nameTitle);

        const statusBadge = document.createElement('div');
        statusBadge.classList.add('reservation-status');
        switch(r.estado) {
          case 'pendiente': statusBadge.classList.add('status-pending'); statusBadge.textContent = 'Pendiente'; break;
          case 'aceptada': statusBadge.classList.add('status-accepted'); statusBadge.textContent = 'Aceptada'; break;
          case 'rechazada': statusBadge.classList.add('status-rejected'); statusBadge.textContent = 'Rechazada'; break;
        }
        header.appendChild(statusBadge);

        rDiv.appendChild(header);

        const email = document.createElement('div');
        email.textContent = 'Correo: ' + r.email_cliente;
        rDiv.appendChild(email);

        const createdAt = document.createElement('div');
        const createdDate = new Date(r.creado_en);
        createdAt.textContent = 'Reservado el: ' + createdDate.toLocaleString('es-ES', { year:'numeric', month:'short', day:'numeric', hour:'2-digit', minute:'2-digit'});
        createdAt.style.fontSize = '0.85rem';
        createdAt.style.color = '#666';
        rDiv.appendChild(createdAt);

        // Admin action buttons only if reservation is pending
        if(r.estado === 'pendiente') {
          const actionsDiv = document.createElement('div');
          actionsDiv.style.marginTop = '0.7rem';

          const acceptBtn = document.createElement('button');
          acceptBtn.textContent = 'Aceptar';
          acceptBtn.classList.add('btn-action', 'btn-accept');
          acceptBtn.addEventListener('click', () => {
            updateReservationState(r.id, 'aceptada');
          });

          const rejectBtn = document.createElement('button');
          rejectBtn.textContent = 'Rechazar';
          rejectBtn.classList.add('btn-action', 'btn-reject');
          rejectBtn.addEventListener('click', () => {
            updateReservationState(r.id, 'rechazada');
          });

          actionsDiv.appendChild(acceptBtn);
          actionsDiv.appendChild(rejectBtn);
          rDiv.appendChild(actionsDiv);
        }

        reservationList.appendChild(rDiv);
      });
    }

    function updateReservationState(id, newState) {
      const resv = reservations.find(r => r.id === id);
      if(resv) {
        resv.estado = newState;
        saveReservations();
        renderReservationList();
        showNotification(`Reserva ${newState === 'aceptada' ? 'aceptada' : 'rechazada'} con éxito.`, 3000);
      }
    }

    // --- Availability Toggle ---

    function renderDaysToggle() {
      daysToggle.innerHTML = '';
      daysOfWeek.forEach((dayName, dIndex) => {
        const btn = document.createElement('div');
        btn.className = 'day-toggle';
        if(availability[dIndex]) {
          btn.classList.add('available');
        }
        btn.textContent = dayName;
        btn.title = 'Haga clic para alternar disponibilidad para este día';
        btn.addEventListener('click', () => {
          availability[dIndex] = !availability[dIndex];
          saveAvailability();
          renderDaysToggle();
          updateTimeOptions();
          showNotification(`${dayName} ${availability[dIndex] ? 'disponible' : 'no disponible'} para reservas.`, 3000);
        });
        daysToggle.appendChild(btn);
      });
    }

    // --- Init ---
    function init() {
      loadReservations();
      loadAvailability();
      loadAdminLogin();

      setMinDate();
      updateTimeOptions();

      if(adminLoggedIn) {
        showAdminControls();
      } else {
        showLoginPrompt();
      }

      switchTab('client');
    }

    init();

  })();
</script>
</body>
</html>
